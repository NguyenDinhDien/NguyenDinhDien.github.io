import{P as _e}from"./profile-f1b0d866.js";import{e as U,_ as ve}from"./successNotification.vue_vue_type_script_setup_true_lang-8de7b1c0.js";import{G as W,Y as ge,Z as fe,d as A,a as G,r as l,x as H,b as S,o as _,c as O,e as n,t as r,g as h,f as b,w as o,h as P,N as he,s as ye,v as be,L as Ee,M as z,y as F,B as N,q as Le,A as Ie,F as C,z as X,j as Se}from"./index-fae5d1f2.js";import{u as we,a as xe,O as ee,d as Ne,R as De}from"./page.constant-c4856d42.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import{g as Ve,a as Te}from"./common-98ce730a.js";import{_ as Ue}from"./userInfo.vue_vue_type_style_index_0_lang-0230a72c.js";import{_ as Oe}from"./index.vue_vue_type_style_index_0_lang-8e78bb98.js";import{D as $e}from"./index-5b3c78e9.js";import{M as Fe}from"./messageDialog-908c7e4b.js";import{u as Pe}from"./profile-6ebe56f0.js";import"./validators-4c406939.js";import"./messages.constants-493f0f9e.js";const te={getInitScreenEmployee:(u,E)=>W.get(ge,{params:{user_id:u,role_id:E}}),syncUserData:u=>W.post(fe,{user_id:u})},Re=u=>(ye("data-v-0fe7f53b"),u=u(),be(),u),ke={class:"positionList bg-white rounded-lg"},je={class:"name-chip items-center h-9"},Be=Re(()=>n("template",null,null,-1)),Ae={class:"text-sm"},Ge={class:"text-sm text-center"},Me={class:"shell dark:bg-gray-200"},ze="desc",Ce=A({__name:"position",props:{employeeList:{type:Array,required:!0}},setup(u){const E=u,{t:m}=G(),w=[{text:"position",value:"position"},{text:"number",value:"number",sortable:!0},{text:"",value:"ratioPeople"}];let D={};const s=l([]);return H(async()=>{var v;(v=E.employeeList)==null||v.forEach(a=>{D[a.position_name]?D[a.position_name]++:D[a.position_name]=1}),s.value=Object.keys(D).map(a=>({position:a,number:D[a],ratioPeople:E.employeeList.length})),s.value.sort((a,d)=>a.number>d.number?-1:a.number<d.number?1:0)}),(v,a)=>{const d=S("EasyDataTable");return _(),O("div",ke,[n("div",je,[n("span",null,r(h(m)("common.position")),1)]),b(d,{class:"positionListCount text-left",headers:w,items:s.value,"hide-footer":"","sort-type":ze,"table-class-name":"customize-table","theme-color":"#4978FB"},{"header-position":o(({text:g})=>[n("span",null,r(h(m)("common."+g)),1)]),"header-number":o(({text:g})=>[P(r(h(m)("common."+g)),1)]),"item-position":o(({position:g})=>[n("span",Ae,r(g),1)]),"item-number":o(({number:g})=>[n("span",Ge,r(g),1)]),"item-ratioPeople":o(({ratioPeople:g,number:V})=>[n("div",Me,[n("div",{class:"bar",style:he({width:Math.round(V/g*100)+"%"})},null,4)])]),default:o(()=>[Be]),_:1},8,["items"])])}}});const He=oe(Ce,[["__scopeId","data-v-0fe7f53b"]]),q=Ee("employeeStore",{state:()=>({employeeList:[]}),actions:{async getGroupEmployee(u,E,m){try{const{data:w}=await te.getInitScreenEmployee(u,E);return this.employeeList=w.data,w.data}catch(w){z(w)}finally{z("error")}},async syncAllUserGroupFromHRM(u,E){try{return await te.syncUserData(u)}catch(m){z(m)}},getUser:()=>{const u=localStorage.getItem("user");return u?JSON.parse(u):null}}}),qe={class:"flex"},Je={class:"basis-4/5 flex select_option"},Ye={class:"pr-4"},Ke={key:1,class:"text-grey text-caption align-self-center"},Ze={class:"pr-4"},Qe={key:1,class:"text-grey text-caption align-self-center"},We={class:"pr-4"},Xe={key:1,class:"text-grey text-caption align-self-center"},et={class:"basis-1/5 float-right"},tt=A({__name:"selectedOption",props:["positionList","departmentList","groupList","groupUserId"],setup(u,{emit:E}){const{t:m}=G(),w=q(),D=E,s=l([]),v=l([]),a=l([]),d=l(!1);let g="sync_success";const V=()=>{let x={selectPositions:s.value,selectDepartments:v.value,selectGroups:a.value};U.emit("doSelectFilter",x)},$=l("");U.on("getUserIdStr",x=>{$.value=x});const R=x=>{U.emit("show-loading");const f=l("");if(x==""){let y=w.employeeList.map(L=>L.user_id);f.value=y.join(",")}else f.value=x;w.syncAllUserGroupFromHRM(f.value,m).then(async y=>{y.status==200&&(d.value=!0,D("reloadEmployeeList"))}).catch(y=>{console.log(y)}).finally(async()=>{U.emit("hide-loading"),await new Promise(y=>setTimeout(y,3e3)),d.value=!1})};return(x,f)=>{const y=S("v-chip"),L=S("v-select"),p=S("v-icon"),I=S("v-btn"),t=S("v-dialog");return _(),O("div",qe,[n("div",Je,[n("div",Ye,[b(L,{id:"positionSelect",modelValue:s.value,"onUpdate:modelValue":[f[0]||(f[0]=c=>s.value=c),V],items:u.positionList,multiple:"",placeholder:h(m)("common.select_all"),class:"rounded-lg w-48"},{selection:o(({item:c,index:e})=>[e<1?(_(),F(y,{key:0},{default:o(()=>[n("span",null,r(c.title),1)]),_:2},1024)):N("",!0),e===1?(_(),O("span",Ke," (+"+r(s.value.length-1)+") ",1)):N("",!0)]),_:1},8,["modelValue","items","placeholder"])]),n("div",Ze,[b(L,{id:"departmentSelect",modelValue:v.value,"onUpdate:modelValue":[f[1]||(f[1]=c=>v.value=c),V],items:u.departmentList,placeholder:h(m)("common.select_all"),color:"primary",multiple:"",class:"rounded-lg w-52"},{selection:o(({item:c,index:e})=>[e<1?(_(),F(y,{key:0},{default:o(()=>[n("span",null,r(c.title),1)]),_:2},1024)):N("",!0),e===1?(_(),O("span",Qe," (+"+r(v.value.length-1)+") ",1)):N("",!0)]),_:1},8,["modelValue","items","placeholder"])]),n("div",We,[b(L,{id:"groupSelect",modelValue:a.value,"onUpdate:modelValue":[f[2]||(f[2]=c=>a.value=c),V],items:u.groupList,placeholder:h(m)("common.select_all"),multiple:"",class:"rounded-lg w-36"},{selection:o(({item:c,index:e})=>[e<1?(_(),F(y,{key:0},{default:o(()=>[n("span",null,r(c.title),1)]),_:2},1024)):N("",!0),e===1?(_(),O("span",Xe," (+"+r(a.value.length-1)+") ",1)):N("",!0)]),_:1},8,["modelValue","items","placeholder"])])]),n("div",et,[b(I,{size:"large",color:"#277FFE",height:"40",onClick:f[3]||(f[3]=c=>R($.value)),class:"sync_btn float-right items-center text-white hover:bg-blue-500 font-medium text-sm px-2"},{default:o(()=>[b(p,{class:"items-center",icon:"mdi-cached",size:"small"}),P("â€‚"+r(h(m)("common.data_synchronization")),1)]),_:1})]),b(t,{modelValue:d.value,"onUpdate:modelValue":f[4]||(f[4]=c=>d.value=c),width:"350px"},{default:o(()=>[b(ve,{message:h(g)},null,8,["message"])]),_:1},8,["modelValue"])])}}});const ot=A({__name:"employeeList",props:{employeeList:{type:Array,required:!0}},setup(u,{emit:E}){const{t:m}=G(),w=q(),D=E,s=l([]),v=[{text:"name",value:"userName"},{text:"position",value:"positionName"},{text:"department",value:"departmentName"},{text:"group",value:"groupName"},{text:"team",value:"teamName"},{text:"access_role",value:"roleName"},{text:"",value:"action"}];let a=l([]),d=l([]);const g=l([]),V=l([]),$=l([]);w.getUser();const R=u;H(()=>{x(R.employeeList)});const x=p=>{const I=p;I==null||I.forEach(t=>{const c=l("");Ve(t==null?void 0:t.user_file,t==null?void 0:t.gender,!0).then(e=>c.value=e),a.value.push({userId:t.user_id,email:t.email,fullName:t.full_name,userFile:c,departmentId:t.department_id,departmentName:t.department_name,groupId:t.group_id,groupName:t.group_name,teamId:t.team_id,teamName:t.team_name,positionId:t.position_id,positionName:t.position_name,roleId:t.role_id,roleName:t.role_name,gender:t.gender}),g.value.includes(t.position_name)||g.value.push(t.position_name),V.value.includes(t.department_name)||V.value.push(t.department_name),$.value.includes(t.group_name)||$.value.push(t.group_name)}),d.value=a.value},f=p=>{D("openEmployeeTab",p)},y=l("");Le(s.value,()=>{if(s.value.length>0){let p=s.value.map(I=>I.userId);y.value=p.join(","),U.emit("getUserIdStr",y.value)}}),U.on("doSelectFilter",p=>{const I=a.value.filter(t=>{const c=p.selectPositions.length===0||p.selectPositions.includes(t.positionName),e=p.selectDepartments.length===0||p.selectDepartments.includes(t.departmentName),k=p.selectGroups.length===0||p.selectGroups.includes(t.groupName);return c&&e&&k});d.value=I});const L=()=>{a=l([]),x(R.employeeList)};return(p,I)=>{const t=S("v-icon"),c=S("EasyDataTable");return _(),O(C,null,[b(tt,{positionList:g.value,departmentList:V.value,groupList:$.value,onReloadEmployeeList:L},null,8,["positionList","departmentList","groupList"]),b(c,{id:"employeeList",class:"employeeList w-full bg-white rounded-lg overflow-auto px-3",headers:v,items:h(d),"rows-per-page":1e3,"hide-footer":"","items-selected":s.value,"onUpdate:itemsSelected":I[0]||(I[0]=e=>s.value=e),"table-class-name":"customize-table","theme-color":"#4978FB"},{"header-userName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"header-positionName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"header-departmentName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"header-groupName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"header-teamName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"header-roleName":o(({text:e})=>[n("span",null,r(h(m)("common."+e)),1)]),"item-userName":o(({fullName:e,email:k,userFile:M})=>[b(Ue,{avatar:M,userName:e,userEmail:k},null,8,["avatar","userName","userEmail"])]),"item-positionName":o(({positionName:e})=>[P(r(e),1)]),"item-department":o(({departmentName:e})=>[P(r(e),1)]),"item-groupName":o(({groupName:e})=>[P(r(e),1)]),"item-teamName":o(({teamName:e})=>[P(r(e),1)]),"item-roleName":o(({roleName:e})=>[n("span",{class:Ie(h(Te)(e))},r(e),3)]),"item-action":o(({userId:e})=>[b(t,{onClick:k=>f(e)},{default:o(()=>[P("mdi-chevron-right")]),_:2},1032,["onClick"])]),_:1},8,["items","items-selected"])],64)}}});const st=oe(ot,[["__scopeId","data-v-f920e647"]]),at={class:"main-content text-sm"},lt={id:"employeeHome"},nt={key:0,class:"employee-ome-screen flex"},it={class:"position_layout"},rt={class:"box-employlist"},ut={key:1},ct={class:"project-info"},mt={key:2},dt="employeeScreen",xt=A({__name:"index",setup(u){const{t:E}=G(),m=we(),w=Pe(),D=q(),s=l([{name:"employee",view:"tabEmployee"}]),v=l(0),a=l(""),d=l(0),g=l(0),V=l(0),$=l(""),R=l(""),x=l(""),f=l(!0),y=l("");let L=l(!1);const p=l([]);H(()=>{U.emit("show-loading"),t()});let I=D.getUser();const t=()=>{D.getGroupEmployee(I.user_id,I.role,E).then(i=>{p.value=i}).catch(i=>{console.error(i)}).finally(async()=>{await new Promise(i=>setTimeout(i,500)),U.emit("hide-loading")})},c=()=>{s.value.length--,v.value>0&&v.value--},e=i=>{a.value=i,d.value=xe.ROLE_USER,g.value=ee,s.value.length<2?(Y(),v.value++):(y.value="openEmployeeTab",Q())},k=i=>{V.value=i==null?void 0:i.checklistId,$.value=i==null?void 0:i.userId,R.value=i==null?void 0:i.roleId,x.value=i==null?void 0:i.fullNameLead,f.value=!0,s.value.length<3?(K(),v.value++):(y.value="employeeOpenDoChecklist",Q())},M=()=>{y.value==="openEmployeeTab"?se():ae(),L.value=!1},se=()=>{s.value.length>2?le():J(),Y(),ne(),Z()},ae=()=>{J(),K(),ie(),Z()},J=()=>{s==null||s.value.pop()},le=()=>{console.log(2),s==null||s.value.splice(-2,2)},Y=()=>{s.value.push({name:"employee_information",view:"tabEmployeeInfo"})},K=()=>{s.value.push({name:"do_checklist",view:"employeeDoChecklist"})},Z=()=>{v.value++},ne=()=>{m.getHomeProject(a==null?void 0:a.value,d==null?void 0:d.value,Ne,E).then(i=>{U.emit("reloadProjectTab",i)}),w.getProfileById(a==null?void 0:a.value,De,ee,E).then(i=>{U.emit("reloadProfile",i)})},ie=()=>{U.emit("reloadDoChecklistData")},Q=()=>{L.value=!0};return U.on("closeDialog",()=>{L.value=!1}),(i,j)=>{const re=S("v-tab"),ue=S("v-icon"),ce=S("v-tabs"),me=S("v-window-item"),de=S("v-window"),pe=S("v-dialog");return _(),O("div",null,[b(ce,{modelValue:v.value,"onUpdate:modelValue":j[0]||(j[0]=T=>v.value=T),id:"tabbar",class:"bg-white"},{default:o(()=>[(_(!0),O(C,null,X(s.value,(T,B)=>(_(),F(re,{key:B,value:B,class:"tab-item"},{default:o(()=>[P(r(h(E)("common."+T.name)),1)]),_:2},1032,["value"]))),128)),s.value.length>1?(_(),F(ue,{key:0,icon:"mdi-close",size:"x-small",onClick:c})):N("",!0)]),_:1},8,["modelValue"]),n("div",at,[n("div",lt,[b(de,{modelValue:v.value,"onUpdate:modelValue":j[1]||(j[1]=T=>v.value=T)},{default:o(()=>[(_(!0),O(C,null,X(s.value,(T,B)=>(_(),F(me,{key:B,value:B},{default:o(()=>[T.view==="tabEmployee"?(_(),O("div",nt,[n("div",it,[p.value.length>0?(_(),F(He,{key:0,employeeList:p.value},null,8,["employeeList"])):N("",!0)]),n("div",rt,[p.value.length>0?(_(),F(st,{key:0,employeeList:p.value,onOpenEmployeeTab:e},null,8,["employeeList"])):N("",!0)])])):N("",!0),T.view==="tabEmployeeInfo"?(_(),O("div",ut,[b(_e,{userId:a.value,role:d.value,objectStatus:g.value,isVisibleBtn:!0},null,8,["userId","role","objectStatus"]),n("div",ct,[b(Oe,{userId:a.value,role:d.value,objectStatus:g.value,screenName:dt,statusMode:!1,onEmployeeOpenDoChecklist:k},null,8,["userId","role","objectStatus"])])])):N("",!0),T.view==="employeeDoChecklist"?(_(),O("div",mt,[b($e,{checklistIdProps:V.value,userIdProps:$.value,roleIdProps:d.value,fullNameLeadPros:x.value,disableInputFromParentProps:f.value},null,8,["checklistIdProps","userIdProps","roleIdProps","fullNameLeadPros","disableInputFromParentProps"])])):N("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),b(pe,{modelValue:h(L),"onUpdate:modelValue":j[2]||(j[2]=T=>Se(L)?L.value=T:L=T),width:"30%"},{default:o(()=>[h(L)?(_(),F(Fe,{key:0,title:"confirm",onAgreeDialog:M,message:"message_add_do_checklist_tab",typeBtn:"primary"})):N("",!0)]),_:1},8,["modelValue"])])])])}}});export{xt as default};
