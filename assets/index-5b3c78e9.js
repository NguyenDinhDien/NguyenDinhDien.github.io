import{c as Pe,f as ye,d as be,b as Ce}from"./common-98ce730a.js";import{G as B,al as xe,am as Ie,an as De,ao as Se,ap as je,aq as Ve,ar as Fe,L as oe,M as $,d as Z,a as A,m as W,b as p,o as v,y as q,w as i,f as n,e as t,t as d,g as f,c as x,z as ee,h as U,B as w,F as z,u as Ue,q as we,x as Te,r as F}from"./index-fae5d1f2.js";import{M as X}from"./messages.constants-493f0f9e.js";import{e as y,_ as Ee}from"./successNotification.vue_vue_type_script_setup_true_lang-8de7b1c0.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Re}from"./messageDialog-908c7e4b.js";import{u as Le,C as O,a as le,c as Me,d as Oe}from"./page.constant-c4856d42.js";const Q={getDoChecklist:(e,l)=>B.get(xe,{params:{user_id:e,checklist_id:l}}),postDoChecklist:e=>B.post(Ie,e),putDoChecklist:e=>B.put(De,e)},K={getChecklistResultCount:(e,l,h)=>B.get(Se,{params:{user_id:e,role_id:l,object_status:h}}),getUserListInChecklist:e=>B.get(je,{params:{checklist_id:e}}),putChecklistResultBulkUpdate:(e,l,h,u)=>B.put(Ve,{checklist_id:e,user_id:l,manager_id:h,status:u}),putChecklistStatusUpdate:(e,l)=>B.put(Fe,{checklist_id:e,status:l})},ne=oe("doChecklist",{state:()=>({firstIdRequired:""}),actions:{async getDoChecklist(e,l,h){try{return await Q.getDoChecklist(e,l)}catch(u){$(u)}},async postSaveChecklistResult(e,l){try{return await Q.postDoChecklist(e)}catch(h){$(h)}},async putUpdateChecklistResult(e,l){try{return await Q.putDoChecklist(e)}catch(h){$(h)}}}}),Be={class:"category-header"},$e={class:""},qe={class:"text-left w-40"},Ne={class:"text-left w-min_210"},He={class:"text-left w-60"},Ye={class:"text-left w-min_210 pl-6"},Ae=["id"],Ke={class:"d-flex align-center"},ze={class:"index-detail"},Ge={class:"ml-4"},Je=["innerHTML"],Qe={key:0},We={key:0,class:"text-red text-xs pl-2"},Xe=Z({__name:"checklistDetailItem",props:{categoryProp:{type:Object,default:null},listCategoryDetailProp:{type:Array},statusDisabledProp:{type:Boolean,default:!1},disableInputFromParentProps:{type:Boolean,default:!1},enableValidateProp:{type:Boolean,required:!0}},setup(e){const{t:l}=A(),{locale:h}=A(),u=W(()=>h.value),I=ne(),D=W(()=>I.firstIdRequired);return y.on("doChecklist-scrollToRequired",()=>{const S=document.getElementById(D.value);S==null||S.scrollIntoView({behavior:"smooth",block:"end"})}),(S,k)=>{const c=p("v-icon"),b=p("v-checkbox"),T=p("v-text-field"),L=p("v-table"),j=p("v-card"),V=p("v-col");return v(),q(V,null,{default:i(()=>[n(j,null,{default:i(()=>[t("div",Be,[t("h1",null,[t("b",null,d(u.value=="vi"?e.categoryProp.category_name_vn:e.categoryProp.category_name_jp),1)])]),n(L,null,{default:i(()=>[t("thead",null,[t("tr",$e,[t("th",qe,d(f(l)("common.header_dochecklist_detail_name")),1),t("th",Ne,d(f(l)("common.header_dochecklist_confirmation_method")),1),t("th",He,d(f(l)("common.header_dochecklist_confirmation_standard")),1),t("th",Ye,d(f(l)("common.header_dochecklist_checked")),1)])]),t("tbody",null,[(v(!0),x(z,null,ee(e.listCategoryDetailProp,(r,g)=>(v(),x("tr",{key:r.checklist_detail_id,class:"row_do-checklist",id:r.checklist_detail_id.toString()},[t("td",null,[t("span",Ke,[t("p",ze,d(g+1)+".",1),t("p",Ge,d(u.value=="vi"?r.category_detail_name_vn:r.category_detail_name_jp),1)])]),t("td",null,d(u.value=="vi"?r.confirmation_method_vn:r.confirmation_method_jp),1),t("td",null,[t("span",{innerHTML:f(Pe)(u.value=="vi"?r.confirmation_standard_vn:r.confirmation_standard_jp)},null,8,Je)]),t("td",null,[n(b,{modelValue:r.checked,"onUpdate:modelValue":C=>r.checked=C,value:1,disabled:e.statusDisabledProp||e.disableInputFromParentProps,"hide-details":"","true-icon":"mdi-checkbox-outline",color:"grey",class:"d-flex h-cus_37"},{label:i(()=>[n(c,{color:"green"},{default:i(()=>[U("mdi-checkbox-blank-circle-outline")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),n(b,{modelValue:r.checked,"onUpdate:modelValue":C=>r.checked=C,value:0,disabled:e.statusDisabledProp||e.disableInputFromParentProps,"true-icon":"mdi-checkbox-outline",color:"grey",class:"d-flex h-cus_37"},{label:i(()=>[n(c,{color:"red"},{default:i(()=>[U("mdi-window-close")]),_:1}),r.checked===0?(v(),q(T,{key:0,modelValue:r.reason,"onUpdate:modelValue":C=>r.reason=C,placeholder:f(l)("common.label_reason"),class:"py-2 pl-2 txt-reason",rounded:"lg",error:r.reason==""},null,8,["modelValue","onUpdate:modelValue","placeholder","error"])):w("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),e.enableValidateProp?(v(),x("div",Qe,[r.checked===!1?(v(),x("div",We,d(f(l)("messages."+f(X))),1)):w("",!0)])):w("",!0)])],8,Ae))),128))])]),_:1})]),_:1})]),_:1})}}});const Ze=te(Xe,[["__scopeId","data-v-b9e687d5"]]),et={class:"category-header"},tt={class:"text-left w-40"},at={class:"text-left pl-6"},st=["id"],lt={class:"d-flex align-center"},ot={class:"index-detail"},nt={class:"ml-4"},it={class:"text-black"},ct={key:0},dt={key:0,class:"text-red text-xs pl-2"},rt={colspan:"2"},_t={class:"d-flex flex-wrap"},ut={class:"flex-1-1-100 ma-2 pa-2 ml-0 pl-0 text-size_th"},ht={"col-span":"2"},mt={class:"ma-2 pa-2 ml-0 pl-0 w-cus_410"},pt={for:"dateInput",class:"text-high-emphasis"},ft={class:"input-date"},vt=["id"],kt={class:"text-black"},gt={key:0},Pt={key:0,class:"text-red text-xs pl-2"},yt=Z({__name:"checklistFinishedItem",props:{checklistFinishedProp:{type:Object,required:!0},finishedDetailProp:{type:Array},statusDisabledProp:{type:Boolean,required:!0},disableInputFromParentProps:{type:Boolean,required:!0},enableValidateProp:{type:Boolean,required:!0}},setup(e){const{t:l}=A(),{locale:h}=A(),u=W(()=>h.value);return(I,D)=>{const S=p("v-checkbox"),k=p("VueDatePicker"),c=p("v-table"),b=p("v-card"),T=p("v-col");return v(),q(T,null,{default:i(()=>[n(b,null,{default:i(()=>{var L,j;return[t("div",et,[t("h1",null,[t("b",null,d(u.value=="vi"?(L=e.checklistFinishedProp)==null?void 0:L.item_name_vn:(j=e.checklistFinishedProp)==null?void 0:j.item_name_jp),1)])]),n(c,null,{default:i(()=>{var V,r;return[t("thead",null,[t("tr",null,[t("th",tt,d(f(l)("common.header_dochecklist_detail_name")),1),t("th",at,d(f(l)("common.header_dochecklist_checked")),1)])]),t("tbody",null,[(v(!0),x(z,null,ee(e.finishedDetailProp,(g,C)=>(v(),x("tr",{key:g.checklist_finished_id,class:"row_do-checklist",id:"finished_"+g.checklist_finished_id.toString()},[t("td",null,[t("span",lt,[t("p",ot,d(C+1)+".",1),t("p",nt,d(u.value=="vi"?g.item_detail_name_vn:g.item_detail_name_jp),1)])]),t("td",null,[n(S,{disabled:e.statusDisabledProp||e.disableInputFromParentProps,modelValue:g.checked,"onUpdate:modelValue":G=>g.checked=G,"true-value":1,"false-value":0,"true-icon":"mdi-checkbox-outline",color:"grey",class:"d-flex"},{label:i(()=>[t("p",it,d(u.value=="vi"?g.confirmation_content_vn:g.confirmation_content_jp),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),e.enableValidateProp?(v(),x("div",ct,[g.checked===0?(v(),x("div",dt,d(f(l)("messages."+f(X))),1)):w("",!0)])):w("",!0)])],8,st))),128)),t("tr",null,[t("td",rt,[t("div",_t,[t("div",ut,[t("div",ht,[t("b",null,d(u.value=="vi"?(V=e.checklistFinishedProp)==null?void 0:V.item_policy_vn:(r=e.checklistFinishedProp)==null?void 0:r.item_policy_jp),1)])]),t("div",mt,[t("label",pt,d(f(l)("common.confirm_date")),1),t("span",ft,[n(k,{modelValue:e.checklistFinishedProp.finished_date,"onUpdate:modelValue":D[0]||(D[0]=g=>e.checklistFinishedProp.finished_date=g),disabled:e.statusDisabledProp||e.disableInputFromParentProps,format:"yyyy/MM/dd",placeholder:"YYYY/MM/DD","enable-time-picker":!1,"text-input":"",teleport:!0},null,8,["modelValue","disabled"])])]),t("div",{class:"ma-2 pa-2 ml-0 pl-1",id:"signature_"+e.checklistFinishedProp.finished_id.toString()},[n(S,{disabled:e.statusDisabledProp||e.disableInputFromParentProps,modelValue:e.checklistFinishedProp.finished_signature,"onUpdate:modelValue":D[1]||(D[1]=g=>e.checklistFinishedProp.finished_signature=g),"true-icon":"mdi-checkbox-outline",color:"grey"},{label:i(()=>[t("p",kt,d(f(l)("common.confirm_sign")),1)]),_:1},8,["disabled","modelValue"]),e.enableValidateProp?(v(),x("div",gt,[e.checklistFinishedProp.finished_signature===!1?(v(),x("div",Pt,d(f(l)("messages."+f(X))),1)):w("",!0)])):w("",!0)],8,vt)])])])])]}),_:1})]}),_:1})]),_:1})}}});const bt=te(yt,[["__scopeId","data-v-ea4129b9"]]),Ct=oe("project",{actions:{async getChecklistResultCount(e,l,h,u){try{return await K.getChecklistResultCount(e,l,h)}catch(I){$(I)}},async getUserListInChecklist(e,l){try{return await K.getUserListInChecklist(e)}catch(h){$(h)}},async putChecklistResultBulkUpdate(e,l,h,u,I){try{return await K.putChecklistResultBulkUpdate(e,l,h,u)}catch(D){$(D)}},async putChecklistStatusUpdate(e,l,h){try{return await K.putChecklistStatusUpdate(e,l)}catch(u){$(u)}}}}),xt={id:"container-dochecklist",class:"pa-0"},It={class:"list-project_info"},Dt={class:"item-project_info"},St={class:"d-flex justify-space-between full-height-card align-center px-4"},jt={class:"item-project_info"},Vt={class:"scroll-bar_container"},Ft={class:"scroll-bar-y"},Ut=Z({__name:"index",props:{checklistIdProps:{type:Number,required:!0},userIdProps:{type:String,required:!0},roleIdProps:{type:Number,required:!1},fullNameLeadPros:{type:String,required:!0},disableInputFromParentProps:{type:Boolean,required:!0},isProjectOpenMode:{type:Boolean,required:!1}},setup(e){const{t:l}=A(),u=Ue().getUser(),I=ne(),D=Le(),S=Ct(),k=e;we(()=>k.userIdProps,s=>{k.userIdProps=s,y.emit("show-loading"),T()}),Te(async()=>{y.emit("show-loading"),T()});const c=F({checklist_id:0,checklist_result_id:0,project_name:"",team_name:"",year_month:"",manager_id:"",comment:"",status:0}),b=F(0),T=()=>{I.getDoChecklist(k.userIdProps,k.checklistIdProps,l).then(s=>{const o=s.data.data,a=o.checklist_result;c.value={checklist_id:a.checklist_id,checklist_result_id:a.checklist_result_id,project_name:a.project_name,team_name:a.team_name,year_month:ye(a.year_month),manager_id:a.manager_id,comment:a.comment,status:a.status},G(o),ie(o.checklist_result_finished),b.value=a.status,g(b.value,k.roleIdProps)}).catch(s=>{console.log(s)}).finally(()=>{y.emit("hide-loading")})},L=F(!1),j=F(!0),V=F(""),r=F(!1),g=(s,o)=>{switch(s){case O.OPEN:j.value=!1,V.value="finished",r.value=!0,c.value.status=O.FINISHED;break;case O.FINISHED:j.value=!0,o==le.ROLE_USER?(V.value="finished_cancel",c.value.status=O.OPEN):(V.value="confirm",c.value.status=O.CONFIRMED,c.value.manager_id=u.user_id),r.value=!0;break;case O.CONFIRMED:j.value=!0,o==le.ROLE_USER?r.value=!1:(V.value="confirm_cancel",c.value.status=O.FINISHED,r.value=!0);break;default:r.value=!1;break}},C=F([]),G=s=>{C.value=s.checklist_result_detail.reduce((o,a)=>{const _=o.find(m=>m.category_id===a.category_id);if(_)_.category_detail.push({checklist_detail_id:a.checklist_detail_id,category_detail_name_vn:a.category_detail_name_vn,category_detail_name_jp:a.category_detail_name_jp,confirmation_method_vn:a.confirmation_method_vn,confirmation_method_jp:a.confirmation_method_jp,confirmation_standard_vn:a.confirmation_standard_vn,confirmation_standard_jp:a.confirmation_standard_jp,checked:a.checklist_detail_id_check==0?!1:a.checked,reason:a.reason});else{const m={category_id:a.category_id,category_name_vn:a.category_name_vn,category_name_jp:a.category_name_jp,category_detail:[{checklist_detail_id:a.checklist_detail_id,category_detail_name_vn:a.category_detail_name_vn,category_detail_name_jp:a.category_detail_name_jp,confirmation_method_vn:a.confirmation_method_vn,confirmation_method_jp:a.confirmation_method_jp,confirmation_standard_vn:a.confirmation_standard_vn,confirmation_standard_jp:a.confirmation_standard_jp,checked:a.checked,reason:a.reason}]};o.push(m)}return o},[])},P=F(),ie=s=>{const o=s.reduce((_,m)=>{const M={checklist_finished_id:m.checklist_finished_id,item_detail_name_vn:m.item_detail_name_vn,item_detail_name_jp:m.item_detail_name_jp,confirmation_content_vn:m.confirmation_content_vn,confirmation_content_jp:m.confirmation_content_jp,checked:m.checked};return _.push(M),_},[]);let a=be(c.value.year_month);s.forEach(_=>{P.value={finished_id:_.finished_id,item_name_vn:_.item_name_vn,item_name_jp:_.item_name_jp,item_finished_detail:o,finished_date:ce(a),finished_signature:_.finished_signature,item_policy_vn:_.item_policy_vn,item_policy_jp:_.item_policy_jp}})},ce=s=>(s=Ce(s),s=s.replace(/\//g,"-"),s),N=F(!1),H=F(!1),de=()=>{if(L.value=!0,b.value==0){let s=re();if(s!==!1){I.firstIdRequired=s,y.emit("doChecklist-scrollToRequired");return}}N.value=!0},re=()=>{var o,a;let s=null;e:for(const _ of C.value)for(const m of _.category_detail)if(m.checked===0&&m.reason===""||m.checked===!1){s=m.checklist_detail_id.toString();break e}return s||(s=(o=P.value)==null?void 0:o.item_finished_detail.find(_=>_.checked===0),s?"finished_"+s.checklist_finished_id.toString():((a=P.value)==null?void 0:a.finished_signature)===!1?"signature_"+P.value.finished_id.toString():!1)};y.on("closeDialog",()=>{N.value=!1});const _e=()=>{N.value=!1,ue()},ue=()=>{b.value==0?he():pe()},he=()=>{var a,_,m,M;const s=c.value.checklist_result_id,o={checklist_result:{checklist_result_id:s,checklist_id:c.value.checklist_id,user_id:k.userIdProps,manager_id:c.value.manager_id,comment:c.value.comment,finished_id:((a=P.value)==null?void 0:a.finished_id)??null,finished_date:((_=P.value)==null?void 0:_.finished_date)??null,finished_signature:((m=P.value)==null?void 0:m.finished_signature)??null,status:c.value.status},checklist_result_detail:[],checklist_result_finished:[]};C.value.forEach(E=>{E.category_detail.forEach(Y=>{o.checklist_result_detail.push({checklist_result_id:s,checklist_detail_id:Y.checklist_detail_id,checked:Y.checked,reason:Y.checked==0?Y.reason:""})})}),(M=P.value)==null||M.item_finished_detail.forEach(E=>{o.checklist_result_finished.push({checklist_result_id:s,checklist_finished_id:E.checklist_finished_id,checked:E.checked})}),me(o)},me=s=>{y.emit("show-loading"),I.postSaveChecklistResult(s,l).then(o=>{H.value=!0,T(),ae()}).catch(o=>{console.error(o)}).finally(()=>{y.emit("hide-loading"),setTimeout(()=>{H.value=!1},3e3)})},pe=()=>{var o,a,_;const s={checklist_result_id:c.value.checklist_result_id,checklist_id:c.value.checklist_id,user_id:k.userIdProps,manager_id:c.value.manager_id,comment:c.value.comment,finished_id:((o=P.value)==null?void 0:o.finished_id)??null,finished_date:((a=P.value)==null?void 0:a.finished_date)??null,finished_signature:((_=P.value)==null?void 0:_.finished_signature)??null,status:c.value.status};fe(s)},fe=s=>{y.emit("show-loading"),I.putUpdateChecklistResult(s,l).then(o=>{H.value=!0,T(),k.isProjectOpenMode?ve():ae()}).catch(o=>{console.error(o)}).finally(()=>{setTimeout(()=>{H.value=!1},3e3)})},ae=()=>{D.getHomeProject(u.user_id,Me,Oe,l).then(s=>{y.emit("reloadProjectTab",s)})},ve=()=>{S.getChecklistResultCount(u.user_id,u.role,1,l).then(s=>{y.emit("reloadProjectChecklist",s)}),S.getUserListInChecklist(c.value.checklist_id,l).then(s=>{y.emit("reloadUserList",s)})};return y.on("reloadDoChecklistData",()=>{T()}),(s,o)=>{const a=p("v-card-subtitle"),_=p("v-card-title"),m=p("v-card-item"),M=p("v-card"),E=p("v-sheet"),Y=p("v-textarea"),J=p("v-row"),ke=p("v-btn"),ge=p("v-col"),se=p("v-dialog");return v(),x(z,null,[t("div",xt,[t("div",It,[t("div",Dt,[n(M,{class:"full-height-card"},{default:i(()=>[t("div",St,[n(m,{class:"item-card_project"},{default:i(()=>[n(a,null,{default:i(()=>[U(d(f(l)("common.project_name")),1)]),_:1}),n(_,null,{default:i(()=>[U(d(c.value.project_name),1)]),_:1})]),_:1}),n(m,{class:"item-card_project"},{default:i(()=>[n(a,null,{default:i(()=>[U(d(f(l)("common.team")),1)]),_:1}),n(_,null,{default:i(()=>[U(d(c.value.team_name),1)]),_:1})]),_:1}),n(m,{class:"item-card_project"},{default:i(()=>[n(a,null,{default:i(()=>[U(d(f(l)("common.period")),1)]),_:1}),n(_,null,{default:i(()=>[U(d(c.value.year_month),1)]),_:1})]),_:1})])]),_:1})]),t("div",jt,[n(M,null,{default:i(()=>[n(E,{class:"d-flex flex-wrap"},{default:i(()=>[n(E,{class:"flex-1-0 mx-4 mt-4 text-medium-emphasis text-size_14"},{default:i(()=>[U(d(f(l)("common.evaluation")),1)]),_:1}),n(E,{class:"mx-4 mt-4 text-size_14"},{default:i(()=>[t("b",null,d(e.fullNameLeadPros),1)]),_:1}),n(E,{class:"flex-1-1-100 mx-4 mb-4 margin-top-7"},{default:i(()=>[n(Y,{class:"text-size_14",modelValue:c.value.comment,"onUpdate:modelValue":o[0]||(o[0]=R=>c.value.comment=R),rows:"2",disabled:!(b.value==1&&e.roleIdProps!=3)||e.disableInputFromParentProps,rounded:"lg","no-resize":!0},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})])]),t("div",Vt,[t("div",Ft,[(v(!0),x(z,null,ee(C.value,(R,Tt)=>(v(),q(J,{key:R.category_id},{default:i(()=>[n(Ze,{categoryProp:R,listCategoryDetailProp:R.category_detail,statusDisabledProp:k.isProjectOpenMode?k.isProjectOpenMode:j.value,disableInputFromParentProps:e.disableInputFromParentProps,enableValidateProp:L.value},null,8,["categoryProp","listCategoryDetailProp","statusDisabledProp","disableInputFromParentProps","enableValidateProp"])]),_:2},1024))),128)),P.value?(v(),q(J,{key:0},{default:i(()=>[n(bt,{checklistFinishedProp:P.value,finishedDetailProp:P.value.item_finished_detail,statusDisabledProp:k.isProjectOpenMode?k.isProjectOpenMode:j.value,disableInputFromParentProps:e.disableInputFromParentProps,enableValidateProp:L.value},null,8,["checklistFinishedProp","finishedDetailProp","statusDisabledProp","disableInputFromParentProps","enableValidateProp"])]),_:1})):w("",!0),r.value&&c.value&&!e.disableInputFromParentProps&&!k.isProjectOpenMode||k.isProjectOpenMode&&b.value!==0&&b.value!==9?(v(),q(J,{key:1,justify:"center",class:""},{default:i(()=>[n(ge,{cols:"4"},{default:i(()=>[n(ke,{onClick:de,class:"w-100 btn-finish"},{default:i(()=>[U(d(f(l)("common."+V.value)),1)]),_:1})]),_:1})]),_:1})):w("",!0)])])]),n(se,{modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=R=>N.value=R),width:"30%"},{default:i(()=>[N.value?(v(),q(Re,{key:0,onAgreeDialog:_e,title:"confirm",message:"message_confirm_action",typeBtn:"primary"})):w("",!0)]),_:1},8,["modelValue"]),n(se,{modelValue:H.value,"onUpdate:modelValue":o[2]||(o[2]=R=>H.value=R),width:"350px"},{default:i(()=>[n(Ee)]),_:1},8,["modelValue"])],64)}}});const wt=te(Ut,[["__scopeId","data-v-c20a6332"]]),qt=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{wt as D,qt as i,Ct as u};
