import{d as q,a as J,u as Q,r as d,x as ae,b as E,o as p,c as w,e as s,t as i,g as u,f as C,w as r,N as oe,h as le,F as R,z as K,A as Z,y as B,B as O}from"./index-fae5d1f2.js";import"./checklist-c171dfb9.js";import{e as f,_ as ne}from"./successNotification.vue_vue_type_script_setup_true_lang-8de7b1c0.js";import{i as G}from"./validators-4c406939.js";import{u as W,D as re}from"./index-5b3c78e9.js";import{a as ue,C as F,S as ce}from"./page.constant-c4856d42.js";import{g as ee,f as ie,b as de,t as me,s as _e}from"./common-98ce730a.js";import{_ as te}from"./userInfo.vue_vue_type_style_index_0_lang-0230a72c.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import{M as ve}from"./messageDialog-908c7e4b.js";import"./messages.constants-493f0f9e.js";const he={id:"information-table-counter"},pe={class:"name-title"},fe={class:"txt-center"},ke={class:"txt-center"},be=q({__name:"projectTable",props:["userId","role","objectStatus","statusMode"],setup(S){const{t:o}=J();Q().getUser();const{userId:$,role:V,objectStatus:b,statusMode:N}=S,T=[{text:"project_name",value:"projectName",sortable:!0},{text:"team",value:"teamName",sortable:!0},{text:"project_lead",value:"projectLead",sortable:!0},{text:"members",value:"members",sortable:!0},{text:"year_month",value:"yearMonth",sortable:!0},{text:"created_date",value:"updatedAt",sortable:!0},{text:"status",value:"status",sortable:!0},{text:"finished",value:"finished",sortable:!0},{text:"confirmed",value:"confirmed",sortable:!0},{text:"",value:"action"}];d([]);const M=d([]);ae(async()=>{A()});const j=W(),A=()=>{j.getChecklistResultCount($,V,b,o).then(_=>{L(_)}).catch(_=>{console.log(_)})},L=_=>{M.value=[];const m=_.data.data;m==null||m.forEach(a=>{const D=d("");ee(a==null?void 0:a.user_file,a==null?void 0:a.gender,!1).then(e=>D.value=e),M.value.push({checklistId:a.checklist_id,projectName:a.project_name,teamName:a.team_name,yearMonth:ie(a.year_month),manageId:a.manager_id,fullName:a.full_name,email:a.email,userFile:a.user_file,members:a.member_list,status:a.status,finished:a.finished,confirmed:a.confirmed,updatedAt:de(a.update_at),avatar:D})})},P=(_,m,a,D,e,I)=>{const n={checklistId:_,projectName:m,yearMonth:a,userId:D,roleId:ue.ROLE_USER,statusDisabledProp:e,fullNameLead:I};f.emit("openProjectChecklistDetailTab",n)};return f.on("reloadProjectChecklist",_=>{L(_)}),(_,m)=>{const a=E("v-icon"),D=E("EasyDataTable");return p(),w("div",he,[s("div",pe,[s("span",null,i(u(o)("common.project_overview")),1)]),C(D,{headers:T,items:M.value,"table-class-name":"customize-table","hide-footer":"","fixed-header":"","theme-color":"#4978FB"},{"header-projectName":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-teamName":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-projectLead":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-members":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-yearMonth":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-updatedAt":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-status":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-finished":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"header-confirmed":r(({text:e})=>[s("span",null,i(u(o)("common."+e)),1)]),"item-projectLead":r(({fullName:e,email:I,avatar:n})=>[C(te,{avatar:n,userName:e,userEmail:I},null,8,["avatar","userName","userEmail"])]),"item-status":r(({status:e})=>[s("span",{style:oe(u(_e)(e))},i(u(o)("common."+u(me)(e))),5)]),"item-finished":r(({finished:e})=>[s("span",fe,i(e),1)]),"item-confirmed":r(({confirmed:e})=>[s("span",ke,i(e),1)]),"item-action":r(({checklistId:e,projectName:I,yearMonth:n,fullName:c})=>[C(a,{id:"progress-project-chevron",onClick:k=>P(e,I,n,S.userId,S.statusMode,c)},{default:r(()=>[le("mdi-chevron-right")]),_:2},1032,["onClick"])]),_:1},8,["items"])])}}});const Pe=se(be,[["__scopeId","data-v-bc4da1e9"]]),Ie={id:"project-checklist"},ge={class:"left-content"},ye={class:"project-employees"},Ce={class:"project-employees-title"},Se={class:"employee-container"},Ne={class:"checklist-numbers"},Le={class:"number-ok"},De={class:"number-ng"},xe={class:"project-btn-group"},we=["disabled"],Ee={class:"right-content"},Me={class:"right-container"},Ue=q({__name:"projectChecklistDetail",props:["userList","checklistIdProps","managerIdProps","roleIdProps","fullNameLeadPros","disableInputFromParentProps","checklistStatusProps"],setup(S){const{t:o}=J(),h=W(),V=Q().getUser(),{userList:b,checklistIdProps:N,managerIdProps:T,roleIdProps:M,fullNameLeadPros:j,disableInputFromParentProps:A,checklistStatusProps:L}=S,P=d(null),_=d(""),m=d(!1),a=d(""),D=t=>{a.value=t},e=()=>!!(b.some(t=>t.status===0)||b.every(t=>t.status===2)),I=()=>G(P.value)?L===9:P.value===9,n=()=>{y.value=!1,setTimeout(()=>{m.value=!1},3e3)},c=()=>{f.emit("show-loading");let t=0;G(P.value)?L!==9?t=F.CLOSED:L===9&&b.some(l=>l.status!==0)?t=F.FINISHED:L===9&&b.every(l=>l.status===0)&&(t=F.OPEN):P.value!==9?t=F.CLOSED:P.value===9&&b.some(l=>l.status!==0)?t=F.FINISHED:P.value===9&&b.every(l=>l.status===0)&&(t=F.OPEN),h.putChecklistStatusUpdate(parseInt(N),t,o).then(l=>{l.status===200&&(m.value=!0,h.getUserListInChecklist(N,o).then(U=>{var v,Y,H,X;P.value=(X=(H=(Y=(v=U.data)==null?void 0:v.data)==null?void 0:Y.checklist_result)==null?void 0:H.checklist_result)==null?void 0:X.status,f.emit("reloadUserList",U),f.emit("reloadDoChecklistData")}),x())}).finally(()=>{f.emit("hide-loading"),n()})},k=()=>{f.emit("show-loading");const t=b.map(l=>l.user_id);h.putChecklistResultBulkUpdate(parseInt(N),t,T,2,o).then(l=>{l.status===200&&(m.value=!0,x(),h.getUserListInChecklist(N,o).then(U=>{f.emit("reloadUserList",U)}),f.emit("reloadDoChecklistData"))}).finally(()=>{n()})},g=()=>{_.value==="confirm"?k():_.value==="close"&&c()},x=()=>{h.getChecklistResultCount(V.user_id,V.role,1,o).then(t=>{f.emit("reloadProjectChecklist",t)}).catch(t=>{console.log(t)})},y=d(!1),z=t=>{_.value=t,y.value=!0};return f.on("closeDialog",()=>{y.value=!1}),(t,l)=>{const U=E("v-dialog");return p(),w(R,null,[s("div",Ie,[s("div",ge,[s("div",ye,[s("div",Ce,i(u(o)("common.members")),1),s("div",Se,[(p(!0),w(R,null,K(S.userList,(v,Y)=>(p(),w("div",{class:Z(["employee-item",v.user_id===a.value?"is-selected":""]),key:Y},[C(te,{avatar:v.user_file,userName:v.full_name,userEmail:v.email,onClick:H=>D(v.user_id)},null,8,["avatar","userName","userEmail","onClick"]),s("div",Ne,[s("span",Le,i(v.OK),1),s("span",De,i(v.NG),1)])],2))),128))])]),s("div",xe,[s("button",{class:"btn-close-checklist",onClick:l[0]||(l[0]=v=>z("close"))},i(u(o)(I()?"common.closed_cancel":"common.close_checklist")),1),s("button",{disabled:e()||I(),class:Z(e()||I()?"btn-disabled":""),onClick:l[1]||(l[1]=v=>z("confirm"))},i(u(o)("common.confirm_all")),11,we)])]),s("div",Ee,[s("div",Me,[C(re,{checklistIdProps:S.checklistIdProps,userIdProps:a.value,fullNameLeadPros:S.fullNameLeadPros,disableInputFromParentProps:S.disableInputFromParentProps,isProjectOpenMode:!0},null,8,["checklistIdProps","userIdProps","fullNameLeadPros","disableInputFromParentProps"])])])]),C(U,{modelValue:y.value,"onUpdate:modelValue":l[2]||(l[2]=v=>y.value=v),width:"30%"},{default:r(()=>[y.value?(p(),B(ve,{key:0,title:"confirm",message:_.value==="close"?"confirm_close_checklist":"confirm_all_action",typeBtn:"primary",onAgreeDialog:g},null,8,["message"])):O("",!0)]),_:1},8,["modelValue"]),C(U,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=v=>m.value=v),width:"350px"},{default:r(()=>[C(ne)]),_:1},8,["modelValue"])],64)}}});const Te=se(Ue,[["__scopeId","data-v-1e8ad41a"]]),Fe={class:"title-time"},$e={class:"main-content"},Ve={id:"project"},je={key:0},Ae={key:1},We=q({__name:"index",setup(S){const o=d([{name:"project",yearMonth:null,view:"Main"}]),h=d(0),{t:$}=J(),b=Q().getUser(),N=d(0),T=d(""),M=d(""),j=d(""),A=d(0),L=d(""),P=d(!1);f.on("openProjectChecklistDetailTab",n=>{N.value=n.checklistId,T.value=n.projectName,M.value=n.yearMonth,j.value=n.userId,A.value=n.roleId,L.value=n.fullNameLead,P.value=!1,o.value.length<2||I(),e(N.value)});const _=n=>{n==null||n.forEach(c=>{const k=d("");ee(c==null?void 0:c.user_file,c==null?void 0:c.gender,!0).then(g=>k.value=g),c.user_file=k})},m=d([]),a=d(null),D=W(),e=n=>{m.value=[],f.emit("getChecklistUserList",n),D.getUserListInChecklist(n,$).then(c=>{var k,g,x,y;m.value=c.data.data.user_exe_result,a.value=(y=(x=(g=(k=c.data)==null?void 0:k.data)==null?void 0:g.checklist_result)==null?void 0:x.checklist_result)==null?void 0:y.status,_(m.value)}),o.value.push({name:T,yearMonth:M,view:"projectChecklist"}),h.value++},I=()=>{o.value.length--,h.value>0&&h.value--};return f.on("reloadUserList",n=>{n.data.data.user_exe_result.forEach(k=>{const g=m.value.find(x=>x.user_id===k.user_id);g&&(g.status=k.status)})}),(n,c)=>{const k=E("v-tab"),g=E("v-icon"),x=E("v-tabs"),y=E("v-window-item"),z=E("v-window");return p(),w(R,null,[C(x,{modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=t=>h.value=t),id:"tabbar"},{default:r(()=>[(p(!0),w(R,null,K(o.value,(t,l)=>(p(),B(k,{key:t,value:l,class:"tab-item"},{default:r(()=>[s("div",null,[s("p",null,i(l===0?u($)("common."+t.name):t.name),1),s("p",Fe,i(t.yearMonth),1)])]),_:2},1032,["value"]))),128)),o.value.length>1?(p(),B(g,{key:0,icon:"mdi-close",size:"x-small",onClick:I})):O("",!0)]),_:1},8,["modelValue"]),s("div",$e,[s("div",Ve,[C(z,{modelValue:h.value,"onUpdate:modelValue":c[1]||(c[1]=t=>h.value=t)},{default:r(()=>[(p(!0),w(R,null,K(o.value,(t,l)=>(p(),B(y,{value:l},{default:r(()=>[t.view==="Main"?(p(),w("div",je,[C(Pe,{userId:u(b).user_id,role:u(b).role,objectStatus:1,statusMode:u(ce).OPEN},null,8,["userId","role","statusMode"])])):O("",!0),t.view==="projectChecklist"?(p(),w("div",Ae,[u(G)(m.value)?O("",!0):(p(),B(Te,{key:0,userList:m.value,checklistIdProps:N.value,managerIdProps:j.value,roleIdProps:A.value,fullNameLeadPros:L.value,disableInputFromParentProps:P.value,checklistStatusProps:a.value},null,8,["userList","checklistIdProps","managerIdProps","roleIdProps","fullNameLeadPros","disableInputFromParentProps","checklistStatusProps"]))])):O("",!0)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])])])],64)}}});export{We as default};
